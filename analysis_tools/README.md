# Analysis Tools

This directory contains helper scripts to analyze the performance of the reasoning agent, specifically focusing on question-asking quality, decision-making trajectory, and token usage.

## `analyze_results.py`

This script parses the `.jsonl` result files generated by the agent (e.g., `result-improved_single_agent_with_search.jsonl`) and generates a detailed Markdown report.

### Features
1.  **Question Quality Analysis**:
    *   Detects **redundant questions** (semantically similar questions asked multiple times).
    *   Identifies **failed questions** (where the patient/environment responded with "cannot answer").
    *   Checks for **proactiveness** (did the agent ask questions?).
2.  **Decision Trajectory**:
    *   Tracks how the agent's answer changed as it gathered more information (e.g., "Improved", "Stable Correct", "Stable Wrong").
    *   Calculates the percentage of available context gathered.
3.  **Token Usage**:
    *   Aggregates input and output tokens per problem and in total.

### Usage

Run the script from the command line:

```bash
python3 analysis_tools/analyze_results.py <path_to_jsonl_file> [--output <path_to_output_md>]
```

### Examples

**Print report to console:**
```bash
python3 analysis_tools/analyze_results.py question_quality_comparison/result-improved_single_agent_with_search.jsonl
```

**Save report to a file:**
```bash
python3 analysis_tools/analyze_results.py question_quality_comparison/result-improved_single_agent_with_search.jsonl --output my_analysis.md
```

### Input Format
The script expects a JSONL file where each line is a JSON object with the following structure (standard output from the agent):

```json
{
  "id": 123,
  "interactive_system": {
    "correct": true,
    "questions": ["Question 1?", "Question 2?"],
    "answers": ["Answer 1", "The patient cannot answer..."],
    "intermediate_choices": ["A", "B", "B"],
    "temp_additional_info": [
      { "usage": { "input_tokens": 100, "output_tokens": 50 } }
    ]
  },
  "info": {
    "initial_info": "...",
    "context": ["...", "..."],
    "correct_answer_idx": "B"
  }
}
```
